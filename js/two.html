<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Image Overlay and Path</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
        }

        #map {
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Add this script to fetch data and populate the hobbits array
    async function fetchData() {
        try {
            const response = await fetch('https://script.google.com/macros/s/AKfycbxa4odZnNUxHBMt6zajSNNs4ESxhgTRrdLaRG800ZDsy3pRsusUuIKrXQoG1jTXm0Lz/exec');
            
            if (response.ok) {
                const data = await response.json();
                // Process the data and save the pairs of "Hobbit" and "Total travelled to Mordor"
                hobbits = data.data
                .filter(hobbit => hobbit.Hobbit && hobbit.Hobbit.trim() !== '') // Filter out blank or undefined 'Hobbit' values
                .map(hobbit => ({
                    name: hobbit.Hobbit,
                    distance: hobbit['Total travelled to Mordor'] || 0
                }));

                // Call the function to update the map with the new hobbits data
                updateMapWithHobbits();
            } else {
                console.error('Failed to fetch data:', response.status, response.statusText);
            }
        } catch (error) {
            console.error('Error during fetch:', error.message);
        }
    }

    // Call the fetchData function when the page loads
    fetchData();

        
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyCk56qtL8l6emBmRSiMr_l_HC5oYZMaEUk",
          authDomain: "ringquest-e46d3.firebaseapp.com",
          databaseURL: "https://ringquest-e46d3-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "ringquest-e46d3",
          storageBucket: "ringquest-e46d3.appspot.com",
          messagingSenderId: "916758075647",
          appId: "1:916758075647:web:3338062833032644a654ca",
          measurementId: "G-ZNCYSZYNJY"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
      </script>

    

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Create a map centered at [0, 0]
        var map = L.map('map', {
            center: [0, 0],            
            maxZoom: 5,
            attributionControl: false
        });

        // Define the dimensions of your image
        var imageWidth = 1725;
        var imageHeight = 4344;

        // Calculate the aspect ratio of the image
        var aspectRatio = imageWidth / imageHeight;

        // Define the height of the map
        var mapHeight = 100;

        // Calculate the width of the map based on the aspect ratio
        var mapWidth = aspectRatio * mapHeight;

        // Define the bounds of your image
        var bounds = [
            [-10.5, -180],
            [mapHeight, mapWidth]
        ];

        // Add the image overlay to the map using the direct web address
        var imageOverlay = L.imageOverlay('https://middleearthmap.app/assets/map.603b0ab7.webp', bounds).addTo(map);

        // Fit the map to the image bounds
        map.fitBounds(bounds);

        // Define the path coordinates in pixel space
        var pathCoordinates = [
            [1484, 1162], [1492, 1176], [1492, 1176], [1492, 1176], [1502, 1184], [1502, 1184], [1502, 1184], [1511, 1195], [1511, 1195], [1511, 1195], [1532, 1207], [1532, 1207], [1532, 1207], [1554, 1217], [1554, 1217], [1554, 1217], [1574, 1220], [1574, 1220], [1574, 1220], [1588, 1221], [1588, 1221], [1588, 1221], [1597, 1213], [1597, 1213], [1597, 1213], [1608, 1208], [1608, 1208], [1608, 1208], [1618, 1208], [1618, 1208], [1618, 1208], [1639, 1208], [1639, 1208], [1639, 1208], [1652, 1207], [1652, 1207], [1652, 1207], [1659, 1204], [1661, 1204], [1663, 1204], [1682, 1201], [1683, 1201], [1684, 1201], [1692, 1199], [1693, 1199], [1694, 1199], [1704, 1201], [1704, 1201], [1704, 1201], [1716, 1200], [1717, 1200], [1718, 1200], [1744, 1201], [1744, 1201], [1744, 1201], [1757, 1202], [1757, 1202], [1757, 1202], [1772, 1209], [1772, 1209], [1772, 1209], [1786, 1215], [1786, 1215], [1786, 1215], [1781, 1200], [1781, 1200], [1781, 1200], [1780, 1187], [1780, 1187], [1780, 1187], [1773, 1176], [1776, 1174], [1779, 1172], [1792, 1160], [1792, 1160], [1792, 1160], [1800, 1150], [1802, 1149], [1804, 1148], [1818, 1134], [1818, 1134], [1818, 1134], [1830, 1129], [1839, 1129], [1848, 1129], [1879, 1132], [1879, 1132], [1879, 1132], [1900, 1132], [1901, 1132], [1902, 1132], [1951, 1133], [1951, 1133], [1951, 1133], [1965, 1137], [1965, 1137], [1965, 1137], [1978, 1145], [1978, 1145], [1978, 1145], [1999, 1151], [1999, 1151], [1999, 1151], [1999, 1169], [1999, 1169], [1999, 1169], [1999, 1178], [2e3, 1180], [2001, 1182], [2006, 1189], [2009, 1193], [2012, 1197], [2018, 1197], [2025, 1200], [2032, 1203], [2055, 1204], [2055, 1204], [2055, 1204], [2088, 1204], [2089, 1204], [2090, 1204], [2106, 1200], [2108, 1200], [2110, 1200], [2129, 1199], [2134, 1197], [2139, 1195], [2168, 1193], [2172, 1191], [2176, 1189], [2184, 1178], [2190, 1175], [2196, 1172], [2208, 1166], [2211, 1165], [2214, 1164], [2222, 1157], [2226, 1155], [2230, 1153], [2240, 1147], [2243, 1145], [2246, 1143], [2262, 1136], [2262, 1136], [2262, 1136], [2273, 1133], [2274, 1133], [2275, 1133], [2287, 1117], [2287, 1117], [2287, 1117], [2289, 1115], [2293, 1109], [2297, 1103], [2304, 1097], [2304, 1096], [2304, 1095], [2306, 1094], [2309, 1086], [2312, 1078], [2324, 1055], [2324, 1055], [2324, 1055], [2334, 1045], [2334, 1045], [2334, 1045], [2336, 1059], [2335, 1060], [2334, 1061], [2331, 1072], [2331, 1073], [2331, 1074], [2328, 1079], [2328, 1084], [2328, 1089], [2336, 1109], [2337, 1109], [2338, 1109], [2338, 1110], [2339, 1115], [2351, 1129], [2360, 1132], [2361, 1133], [2362, 1134], [2385, 1144], [2385, 1144], [2385, 1144], [2391, 1145], [2395, 1145], [2399, 1145], [2404, 1145], [2407, 1146], [2410, 1147], [2421, 1145], [2421, 1145], [2421, 1145], [2443, 1148], [2443, 1148], [2443, 1148], [2453, 1149], [2454, 1150], [2455, 1151], [2470, 1151], [2470, 1151], [2470, 1151], [2484, 1156], [2484, 1156], [2484, 1156], [2492, 1152], [2492, 1152], [2492, 1152], [2507, 1148], [2507, 1148], [2507, 1148], [2514, 1133], [2514, 1133], [2501, 1163], [2500, 1164], [2505, 1179], [2505, 1179], [2505, 1179], [2510, 1190], [2510, 1190], [2510, 1190], [2515, 1203], [2516, 1207], [2517, 1211], [2509, 1232], [2509, 1232], [2509, 1232], [2509, 1234], [2507, 1238], [2505, 1242], [2494, 1272], [2492, 1274], [2490, 1276], [2493, 1282], [2491, 1288], [2471, 1332], [2473, 1333], [2470, 1341], [2467, 1349], [2466, 1349], [2463, 1356], [2457, 1368], [2448, 1377], [2448, 1377], [2448, 1377], [2462, 1388], [2462, 1388], [2462, 1388], [2485, 1394], [2485, 1394], [2485, 1394], [2499, 1399], [2501, 1399], [2503, 1399], [2517, 1403], [2516, 1404], [2515, 1405], [2498, 1405], [2498, 1405], [2498, 1405], [2484, 1405], [2476, 1403], [2468, 1401], [2465, 1401], [2460, 1402], [2455, 1403], [2441, 1405], [2440, 1407], [2439, 1409], [2436, 1416], [2434, 1420], [2432, 1424], [2427, 1438], [2426, 1439], [2425, 1440], [2421, 1450], [2419, 1454], [2417, 1458], [2411, 1469], [2410, 1472], [2409, 1475], [2405, 1481], [2403, 1489], [2401, 1497], [2400, 1506], [2399, 1508], [2398, 1510], [2394, 1524], [2394, 1527], [2394, 1530], [2401, 1534], [2404, 1536], [2407, 1538], [2426, 1541], [2427, 1541], [2428, 1541], [2439, 1539], [2439, 1539], [2439, 1539], [2457, 1538], [2457, 1538], [2457, 1538], [2469, 1534], [2473, 1534], [2477, 1534], [2503, 1536], [2503, 1536], [2503, 1536], [2512, 1535], [2513, 1535], [2514, 1535], [2526, 1538], [2526, 1538], [2526, 1538], [2536, 1544], [2537, 1545], [2538, 1546], [2551, 1557], [2551, 1557], [2551, 1557], [2558, 1574], [2558, 1574], [2558, 1574], [2565, 1594], [2565, 1594], [2565, 1594], [2576, 1604], [2576, 1604], [2576, 1604], [2593, 1611], [2593, 1611], [2593, 1611], [2601, 1628], [2601, 1628], [2601, 1628], [2598, 1646], [2598, 1647], [2598, 1648], [2611, 1652], [2612, 1653], [2613, 1654], [2624, 1666], [2624, 1667], [2624, 1668], [2632, 1676], [2634, 1678], [2636, 1680], [2644, 1684], [2645, 1685], [2646, 1686], [2658, 1694], [2659, 1694], [2660, 1694], [2673, 1700], [2673, 1700], [2673, 1700], [2696, 1713], [2696, 1713], [2696, 1713], [2720, 1723], [2720, 1723], [2720, 1723], [2744, 1727], [2744, 1728], [2744, 1729], [2770, 1732], [2770, 1732], [2770, 1732], [2787, 1745], [2787, 1746], [2787, 1747], [2778, 1761], [2784, 1767], [2790, 1773], [2791, 1784], [2791, 1786], [2791, 1788], [2794, 1803], [2794, 1803], [2794, 1803], [2799, 1810], [2801, 1811], [2803, 1812], [2815, 1819], [2818, 1820], [2821, 1821], [2836, 1827], [2837, 1828], [2838, 1829], [2849, 1837], [2850, 1837], [2851, 1837], [2864, 1845], [2866, 1847], [2868, 1849], [2876, 1854], [2881, 1858], [2886, 1862], [2899, 1873], [2900, 1874], [2901, 1875], [2907, 1879], [2910, 1880], [2913, 1881], [2934, 1888], [2934, 1888], [2934, 1888], [2939, 1886], [2943, 1890], [2947, 1894], [2956, 1900], [2956, 1901], [2956, 1902], [2955, 1909], [2955, 1910], [2955, 1911], [2950, 1920], [2949, 1922], [2948, 1924], [2941, 1932], [2941, 1934], [2941, 1936], [2938, 1957], [2938, 1957], [2938, 1957], [2944, 1967], [2945, 1969], [2946, 1971], [2948, 1976], [2954, 1980], [2960, 1984], [2966, 1985], [2966, 1985], [2966, 1985], [2973, 1985], [2973, 1985], [2973, 1985], [2990, 1983], [2990, 1983], [2990, 1983], [3007, 1976], [3007, 1976], [3007, 1976], [3027, 1984], [3027, 1985], [3027, 1986], [3031, 1999], [3031, 2001], [3031, 2003], [3022, 2020], [3021, 2021], [3020, 2022], [3011, 2038], [3010, 2039], [3009, 2040], [3003, 2048], [3003, 2052], [3003, 2056], [3004, 2070], [3005, 2071], [3006, 2072], [3025, 2081], [3025, 2081], [3025, 2081], [3043, 2090], [3043, 2090], [3043, 2090], [3054, 2100], [3054, 2100], [3054, 2100], [3054, 2113], [3054, 2114], [3054, 2115], [3053, 2130], [3052, 2131], [3051, 2132], [3046, 2149], [3046, 2150], [3046, 2151], [3043, 2164], [3043, 2164], [3043, 2164], [3039, 2176], [3039, 2177], [3039, 2178], [3034, 2188], [3033, 2191], [3032, 2194], [3030, 2208], [3029, 2212], [3028, 2216], [3024, 2226], [3024, 2229], [3024, 2232], [3028, 2247], [3028, 2250], [3028, 2253], [3031, 2267], [3031, 2269], [3031, 2271], [3033, 2283], [3035, 2286], [3037, 2289], [3039, 2303], [3039, 2303], [3039, 2303], [3042, 2321], [3042, 2321], [3042, 2321], [3045, 2343], [3045, 2346], [3045, 2349], [3053, 2366], [3053, 2367], [3053, 2368], [3068, 2372], [3070, 2371], [3072, 2370], [3096, 2355], [3097, 2353], [3098, 2351], [3100, 2351], [3105, 2342], [3110, 2333], [3113, 2320], [3116, 2317], [3119, 2314], [3123, 2310], [3128, 2303], [3133, 2296], [3137, 2288], [3142, 2284], [3147, 2280], [3150, 2274], [3153, 2273], [3156, 2272], [3154, 2270], [3165, 2269], [3186, 2268], [3191, 2268], [3198, 2273], [3205, 2278], [3212, 2278], [3219, 2284], [3237, 2300], [3242, 2303], [3250, 2308], [3258, 2313], [3261, 2317], [3270, 2322], [3279, 2327], [3285, 2329], [3287, 2330], [3289, 2331], [3307, 2338], [3307, 2338], [3307, 2338], [3314, 2348], [3318, 2349], [3327, 2352], [3334, 2356], [3337, 2357], [3344, 2360], [3355, 2368], [3355, 2368], [3355, 2368], [3342, 2383], [3342, 2383], [3342, 2383], [3330, 2397], [3330, 2398], [3330, 2399], [3320, 2420], [3320, 2422], [3320, 2424], [3315, 2446], [3315, 2447], [3315, 2448], [3315, 2461], [3316, 2464], [3317, 2467], [3316, 2490], [3316, 2490], [3316, 2490], [3317, 2516], [3317, 2516], [3317, 2516], [3318, 2525], [3318, 2529], [3318, 2533], [3319, 2547], [3321, 2551], [3323, 2555], [3330, 2566], [3331, 2573], [3332, 2580], [3334, 2593], [3334, 2599], [3334, 2605], [3336, 2608], [3337, 2613], [3338, 2618], [3340, 2622], [3340, 2628], [3340, 2634], [3345, 2652], [3345, 2653], [3345, 2662], [3351, 2668], [3352, 2668], [3353, 2668], [3377, 2672], [3378, 2672], [3379, 2672], [3397, 2671], [3400, 2670], [3403, 2669], [3406, 2668], [3409, 2668], [3412, 2668], [3424, 2670], [3428, 2671], [3432, 2672], [3439, 2673], [3440, 2673], [3441, 2673], [3443, 2675], [3447, 2674], [3451, 2673], [3450, 2653], [3450, 2653], [3450, 2653], [3449, 2646], [3447, 2643], [3445, 2640], [3440, 2634], [3436, 2629], [3432, 2624], [3428, 2616], [3428, 2615], [3428, 2614], [3426, 2605], [3425, 2596], [3422, 2578], [3422, 2575], [3418, 2565], [3414, 2555], [3413, 2549], [3412, 2545], [3411, 2541], [3410, 2534], [3411, 2530], [3449, 2518], [3448, 2517], [3456, 2517], [3464, 2517], [3476, 2517], [3480, 2518], [3484, 2519], [3489, 2520], [3493, 2519], [3502, 2512], [3503, 2512], [3503, 2505], [3503, 2489], [3508, 2484], [3508, 2484], [3508, 2484], [3521, 2482], [3526, 2481], [3531, 2480], [3539, 2481], [3540, 2480], [3541, 2479], [3544, 2478], [3552, 2479], [3560, 2480], [3570, 2481], [3574, 2482], [3578, 2483], [3588, 2484], [3594, 2485], [3600, 2486], [3612, 2486], [3612, 2486], [3612, 2486], [3617, 2488], [3620, 2492], [3623, 2496], [3624, 2496], [3625, 2503], [3626, 2510], [3626, 2510], [3625, 2516], [3622, 2534], [3622, 2536], [3621, 2541]
        ];

        var totalCoordinates = pathCoordinates.length;
        var totalDistance = 1061;

        
        // Convert pixel coordinates to geographical coordinates
        var geoPathCoordinates = pathCoordinates.map(function (coord) {
            var point = map.unproject(coord, map.getMaxZoom());
            return [point.lat, point.lng];
        });

        var pathPolyline = L.polyline(geoPathCoordinates, { color: 'orange' }).addTo(map);

        

        function findListItem(distanceTraveled, totalDistance, totalCoordinates) {
            // If total distance is greater than or equal to the maximum distance, return the last coordinate pair
            if (distanceTraveled >= 1061) {
                return totalCoordinates - 1;
            }

            var relativeDistance = (distanceTraveled / totalDistance) * totalCoordinates;
            var listItem = Math.round(relativeDistance);

            // Ensure listItem is within the valid range
            listItem = Math.min(Math.max(listItem, 0), totalCoordinates - 1);

            return listItem;
        }        

        // Add this function to update the map with the new hobbits data
    function updateMapWithHobbits() {
        // Loop through hobbits array
        hobbits.forEach(function(hobbit, index) {
            // Extract name and distance from the hobbit array
            var name = hobbit.name;
            var distanceTraveled = hobbit.distance;

            // Calculate the corresponding coordinate for the given distance
            var listItem = findListItem(distanceTraveled, totalDistance, totalCoordinates);
            var correspondingCoordinate = pathCoordinates[listItem];

            // Convert marker pixel coordinates to geographical coordinates
            var markerLatLng = map.unproject(correspondingCoordinate, map.getMaxZoom());
            var percentage = (distanceTraveled / totalDistance) * 100;
            var popupContent = `${name}<br>Distance Traveled: ${distanceTraveled.toFixed(2)}km<br>Percentage of Journey: ${percentage.toFixed(2)}%`;
            var marker = L.marker(markerLatLng).addTo(map).bindPopup(popupContent);
        });
    }                   
    </script>
</body>
</html>



